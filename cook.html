<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Focus and Frost - Ứng dụng tập trung</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f3e8;
        }
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .scrollbar-thin::-webkit-scrollbar-track {
            background: transparent;
        }
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background-color: #9bba74;
            border-radius: 3px;
        }
        #googleSignInButton {
            width: 10rem !important;
            height: 2.5rem !important;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #userAvatar {
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            object-fit: cover;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
            transition: transform 0.2s ease;
        }
        #userAvatar:hover, #userAvatar:focus {
            transform: scale(1.1);
            outline: none;
            box-shadow: 0 0 8px rgba(0,0,0,0.4);
        }
        #btn-start-stop {
            transition: all 0.3s ease;
        }
        #cake-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 70vh;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: flex-start;
            align-items: center;
        }
        #cake-list li {
            background: transparent;
            padding: 0;
            cursor: pointer;
            outline: none;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
        }
        #cake-list li:focus,
        #cake-list li:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgb(0 0 0 / 0.2);
            z-index: 10;
        }
        #cake-list li img {
            width: 64px;
            height: 64px;
            object-fit: contain;
            border-radius: 0.5rem;
            user-select: none;
            pointer-events: none;
            display: block;
        }
        #cake-list li span {
            display: none;
        }
        @media (max-width: 480px) {
            #cake-list li img {
                width: 48px;
                height: 48px;
            }
        }
        .chart-container {
            width: 100%;
            height: 300px;
            margin-top: 20px;
            position: relative;
        }
        .chart-bar {
            position: absolute;
            bottom: 0;
            background-color: #9BBA74;
            width: 30px;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            transition: height 0.5s ease;
        }
        .chart-label {
            position: absolute;
            bottom: -25px;
            text-align: center;
            width: 30px;
            font-size: 12px;
        }
        .chart-value {
            position: absolute;
            top: -20px;
            text-align: center;
            width: 30px;
            font-size: 11px;
        }
        .monthly-stats {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .monthly-stats h3 {
            text-align: center;
            margin-bottom: 15px;
            color: #4a5568;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
            background-color: #edf2f7;
            border-radius: 6px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2d3748;
        }
        .stat-label {
            font-size: 0.875rem;
            color: #718096;
        }
    </style>
</head>
<body class="relative min-h-screen flex flex-col items-center bg-[#f0f3e8]">
    <!-- Background Image -->
    <img src="https://i.ibb.co/JRr5YSFS/66-F84-D93-7422-4-D12-AD64-8-B3103-E20-BD3.png" alt="Background với hình dạng trừu tượng màu xanh lá và be, phong cách màu nước, không khí nhẹ nhàng và êm dịu" class="fixed inset-0 w-full h-full object-cover -z-10">

    <!-- Header với Google Login / Logout Button và Avatar -->
    <header class="w-full flex justify-end p-4 max-w-screen-md relative">
        <div id="googleSignInButton" class="w-10 h-10"></div>
        <button id="googleLogoutBtn" aria-label="Đăng xuất tài khoản Google" class="hidden flex items-center justify-center w-10 h-10 rounded-full bg-[#9BBA74] hover:bg-[#8aa85a] text-white font-semibold shadow focus:outline-none focus:ring-2 focus:ring-[#8aa85a]" type="button" title="Đăng xuất tài khoản Google">
            <i class="fas fa-arrow-right"></i>
        </button>
        <img id="userAvatar" src="" alt="Ảnh đại diện người dùng Google" class="hidden absolute top-4 left-4" tabindex="0" aria-label="Ảnh đại diện người dùng Google" draggable="false">
    </header>

    <!-- Main Content -->
    <main class="flex-grow flex flex-col items-center justify-center px-4 pb-20 relative w-full max-w-screen-md" aria-label="Màn hình chính ứng dụng tập trung">
        <!-- Time selector rectangle above circle with progress bar -->
        <div id="time-selector" class="mb-6 w-full max-w-xs rounded-lg border-4 border-[#9BBA74] bg-white bg-opacity-90 p-4 flex flex-col select-none" aria-label="Chọn thời gian giờ phút giây">
            <div class="relative w-full h-10 rounded bg-gray-200 overflow-hidden mb-2" aria-hidden="true">
                <div id="time-progress-bar" class="absolute left-0 top-0 h-10 bg-[#9BBA74] transition-all duration-500 ease-linear" style="width: 100%;"></div>
            </div>
            <div class="flex justify-center space-x-2 z-10 relative">
                <input type="number" id="input-hour" min="0" max="23" placeholder="Giờ" class="w-16 text-center rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] text-lg font-semibold bg-transparent" aria-label="Giờ">
                <span class="text-xl font-semibold text-gray-700 select-none">:</span>
                <input type="number" id="input-minute" min="0" max="59" placeholder="Phút" class="w-16 text-center rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] text-lg font-semibold bg-transparent" aria-label="Phút">
                <span class="text-xl font-semibold text-gray-700 select-none">:</span>
                <input type="number" id="input-second" min="0" max="59" placeholder="Giây" class="w-16 text-center rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] text-lg font-semibold bg-transparent" aria-label="Giây">
            </div>
        </div>

        <!-- Circle with selected cake image -->
        <button id="circle-cake" aria-label="Chọn món ăn" class="relative rounded-full border-8 border-[#9BBA74] w-56 h-56 flex items-center justify-center overflow-hidden shadow-lg bg-white" type="button">
            <img id="cake-image" src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/00CC2FB6-9ED5-4466-9DDB-C7B89C391BB1.png" alt="Hình ảnh Macaron màu hồng pastel, bánh ngọt tròn nhỏ xinh xắn, nền trắng" class="w-40 h-40 object-contain" draggable="false">
            <!-- GIF overlay hidden by default -->
            <img id="cooking-gif" src="https://i.ibb.co/S4dcjq9g/Video.gif" alt="Hình ảnh GIF hoạt hình bánh đang được nấu, màu sắc tươi sáng, nền trong suốt" class="absolute inset-0 w-full h-full object-contain hidden" draggable="false">
        </button>

        <!-- Selected cake name rectangle below circle -->
        <div id="selected-cake-name" class="mt-6 w-full max-w-xs rounded-lg border-4 border-[#9BBA74] bg-white bg-opacity-90 p-3 text-center text-xl font-semibold text-gray-800 select-none min-h-[3rem]" aria-live="polite" aria-atomic="true">
            Macaron
        </div>

        <!-- Bottom rectangle with buttons -->
        <div class="mt-6 w-full max-w-xs rounded-lg border-4 border-[#9BBA74] bg-white bg-opacity-90 p-4 flex items-center justify-between" aria-label="Các nút điều khiển">
            <!-- Left side buttons -->
            <div class="flex space-x-4">
                <button id="btn-statistics" aria-label="Bảng thống kê dạng lưới" class="w-11 h-11 rounded-full bg-[#9BBA74] hover:bg-[#8aa85a] flex items-center justify-center text-white shadow focus:outline-none focus:ring-2 focus:ring-[#8aa85a]" type="button">
                    <i class="fas fa-chart-bar text-lg"></i>
                </button>
            </div>

            <!-- Center Start/Stop/Use Reward button -->
            <button id="btn-start-stop" class="flex-1 mx-4 py-2 rounded-lg font-bold text-white bg-[#9BBA74] hover:bg-[#8aa85a] focus:outline-none focus:ring-2 focus:ring-[#8aa85a]" type="button" aria-live="polite" aria-atomic="true">
                Bắt đầu
            </button>
            
            <!-- Right side buttons -->
            <div class="flex space-x-4">
                <button id="btn-use-reward" aria-label="Sử dụng phần thưởng" class="w-11 h-11 rounded-full bg-[#9BBA74] hover:bg-[#8aa85a] flex items-center justify-center text-white shadow focus:outline-none focus:ring-2 focus:ring-[#8aa85a]" type="button">
                    <i class="fas fa-gift text-lg"></i>
                </button>
            </div>
        </div>

        <!-- Hidden feedback form for submission -->
        <form id="feedback-form" action="https://formspree.io/f/mzzvylbg" method="POST" class="hidden">
            <input type="email" name="email" value="madebyvann">
            <input type="hidden" name="message" id="feedback-message">
        </form>
    </main>

    <!-- Feedback button bottom right -->
    <button id="btn-feedback" aria-label="Góp ý" class="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-[#9BBA74] hover:bg-[#8aa85a] flex items-center justify-center text-white shadow-lg z-50 focus:outline-none focus:ring-2 focus:ring-[#8aa85a]" type="button" title="Góp ý">
        <i class="fas fa-comment-alt text-xl"></i>
    </button>
    <button id="infoToggleBtn" aria-label="Toggle information panel" class="absolute top-4 left-4 p-3 bg-green-600 text-white rounded-full shadow-md hover:bg-green-700 bg-opacity-50 focus:outline-none focus:ring-2 focus:ring-green-400 flex items-center justify-center w-12 h-12">
        <i class="fas fa-question text-lg"></i>
    </button>

    <!-- Logout Confirmation Modal -->
    <div id="logout-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="logout-confirm-title">
        <div class="bg-white rounded-lg max-w-sm w-full p-6 flex flex-col space-y-4 shadow-lg">
            <h2 id="logout-confirm-title" class="text-xl font-semibold text-gray-800 text-center">Bạn có muốn đăng xuất không?</h2>
            <div class="flex justify-center space-x-6">
                <button id="logout-yes-btn" class="px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold focus:outline-none focus:ring-2 focus:ring-[#b0102a]" type="button">Có</button>
                <button id="logout-no-btn" class="px-6 py-2 rounded bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold focus:outline-none focus:ring-2 focus:ring-gray-400" type="button">Không</button>
            </div>
        </div>
    </div>

    <!-- Menu chọn món (hidden by default) -->
    <div id="menu-select-cake" class="fixed bottom-32 left-1/2 transform -translate-x-1/2 w-full max-w-md max-h-60 bg-white bg-opacity-95 rounded-lg border border-gray-300 shadow-lg overflow-y-auto scrollbar-thin hidden z-40" role="list" aria-label="Menu chọn món ăn">
        <div id="menu-cake-list" class="flex flex-wrap justify-center gap-4 p-4">
            <button type="button" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded" data-cake="Macaron" aria-label="Chọn món Macaron">
                <img src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/00CC2FB6-9ED5-4466-9DDB-C7B89C391BB1.png" alt="Hình ảnh Macaron màu hồng pastel, bánh ngọt tròn nhỏ xinh xắn, nền trắng" class="w-14 h-14 object-contain" draggable="false">
                <span class="text-sm font-semibold text-gray-700">Macaron</span>
            </button>
            <button type="button" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded" data-cake="bánh mâm xôi" aria-label="Chọn món bánh mâm xôi">
                <img src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/IMG_7293.png" alt="Hình ảnh quả cà tím tím tươi, bóng mượt, nền trắng" class="w-14 h-14 object-contain" draggable="false">
                <span class="text-sm font-semibold text-gray-700">bánh mâm xôi</span>
            </button>
            <button type="button" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded" data-cake="bánh cherry" aria-label="Chọn món bánh cherry">
                <img src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/B89384A0-0587-48F6-BBCB-4EC98C592F1C.png" alt="Hình ảnh bánh cherry màu đỏ tươi, bánh tròn nhỏ, nền trắng" class="w-14 h-14 object-contain" draggable="false">
                <span class="text-sm font-semibold text-gray-700">bánh cherry</span>
            </button>
        </div>
    </div>

    <!-- Reward modal -->
    <div id="reward-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="reward-title">
        <div class="bg-white rounded-lg max-w-md w-full p-6 flex flex-col space-y-4 shadow-lg max-h-[90vh] overflow-y-auto">
            <h2 id="reward-title" class="text-2xl font-bold text-center text-gray-800 mb-4">Phần thưởng</h2>
            <div id="reward-content" class="flex flex-col items-center"></div>
            <button id="reward-close" class="mt-4 px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold mx-auto focus:outline-none focus:ring-2 focus:ring-[#b0102a]" type="button">Đóng</button>
        </div>
    </div>

    <!-- Statistics modal with monthly chart only -->
    <div id="statistics-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="statistics-title">
        <div class="bg-white rounded-lg max-w-md w-full p-6 flex flex-col space-y-4 shadow-lg max-h-[90vh] overflow-y-auto">
            <h2 id="statistics-title" class="text-2xl font-bold text-center text-gray-800 mb-4">Thống kê theo tháng</h2>
            
            <!-- Chart view -->
            <div id="chart-view">
                <div class="chart-container" id="monthly-chart"></div>
            </div>
            
            <!-- Monthly statistics summary -->
            <div class="monthly-stats">
                <h3>Tổng quan tháng này</h3>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="total-sessions">0</div>
                        <div class="stat-label">Phiên tập trung</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="total-minutes">0</div>
                        <div class="stat-label">Phút tập trung</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="avg-session">0</div>
                        <div class="stat-label">Phút/phiên</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="success-rate">0%</div>
                        <div class="stat-label">Tỷ lệ thành công</div>
                    </div>
                </div>
            </div>
            
            <button id="statistics-close" class="mt-4 px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold mx-auto focus:outline-none focus:ring-2 focus:ring-[#b0102a]" type="button">Đóng</button>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 hidden z-40"></div>

    <!-- Info Panel Centered -->
    <aside id="infoPanel" class="fixed top-1/2 left-1/2 w-80 max-w-full bg-white shadow-lg rounded-lg p-6 transform -translate-x-1/2 -translate-y-1/2 scale-0 transition-transform duration-300 ease-in-out z-50 overflow-y-auto max-h-[80vh]" aria-hidden="true">
        <h2 class="text-2xl font-semibold mb-4 text-green-700">Thông tin</h2>
        <p class="mb-4 text-gray-700">Thông tin</p>
        <ul class="list-disc list-inside space-y-2 text-gray-600">
            <li>1. Sau khi bắt đầu tập trung, không thể thay đổi thời gian.</li>
            <li>2. Cần tập trung từ 5 phút trở lên: nhận được bánh đã chọn.</li>
            <li>3. Nếu có góp ý hay thắc mắc nào hãy bấm vào nút bên góc phải</li>
        </ul>
        <button id="infoImageBtn" type="button" aria-label="Nút dẫn tới https://s.shopee.vn/2LOiiEexWq" class="mt-2 mx-auto block focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded" onclick="window.location.href='https://s.shopee.vn/2LOiiEexWq'" style="width: 36.8rem; max-width: 100%;">
            <img src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/4fb2c5e6beca14572e1804fba69eed7455380768/01483ACC-E2E7-46D0-B15C-35BB9D41E3C4.png" class="w-full h-auto object-contain" draggable="false">
        </button>
        <button id="closeInfoBtn" class="mt-2 px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold mx-auto block focus:outline-none focus:ring-2 focus:ring-[#b0102a]" type="button">Đóng</button>
    </aside>

    <audio id="background-music" loop preload="auto" src="https://github.com/thuyvannnnnn/Focus-and-frost/raw/refs/heads/main/45.audio.mp3"></audio>

    <!-- Script Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client"></script>

    <script>
        // Khởi tạo dữ liệu
        const cakes = {
            Macaron: {
                name: "Macaron",
                img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/00CC2FB6-9ED5-4466-9DDB-C7B89C391BB1.png",
                alt: "Hình ảnh Macaron màu hồng pastel, bánh ngọt tròn nhỏ xinh xắn, nền trắng",
            },
            "bánh mâm xôi": {
                name: "bánh mâm xôi",
                img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/IMG_7293.png",
                alt: "Hình ảnh quả cà tím tím tươi, bóng mượt, nền trắng",
            },
            "bánh cherry": {
                name: "bánh cherry",
                img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/B89384A0-0587-48F6-BBCB-4EC98C592F1C.png",
                alt: "Hình ảnh bánh cherry màu đỏ tươi, bánh tròn nhỏ, nền trắng",
            },
            "bánh nướng bóng đêm": {
                name: "bánh nướng bóng đêm",
                img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/037F53D1-AC5D-4165-BD08-FEFF3F39FD7D.png",
                alt: "Hình ảnh bánh bị cháy đen, bánh tròn, nền trắng",
            }
        };

        // Khởi tạo state
        let selectedCake = "Macaron";
        let selectedTime = { h: 0, m: 0, s: 0 };
        let timerInterval = null;
        let isRunning = false;
        let remainingSeconds = 0;
        let elapsedSeconds = 0;
        let rewardInventory = JSON.parse(localStorage.getItem("rewardInventory")) || [];
        let sessionHistory = JSON.parse(localStorage.getItem("sessionHistory")) || [];
        let googleUser = JSON.parse(localStorage.getItem("googleuser")) || null;

        // Lấy các phần tử DOM
        const cakeImageEl = document.getElementById("cake-image");
        const circleCakeBtn = document.getElementById("circle-cake");
        const selectedCakeNameEl = document.getElementById("selected-cake-name");
        const btnStartStop = document.getElementById("btn-start-stop");
        const inputHour = document.getElementById("input-hour");
        const inputMinute = document.getElementById("input-minute");
        const inputSecond = document.getElementById("input-second");
        const menuSelectCake = document.getElementById("menu-select-cake");
        const cookingGif = document.getElementById("cooking-gif");
        const rewardModal = document.getElementById("reward-modal");
        const rewardContent = document.getElementById("reward-content");
        const rewardCloseBtn = document.getElementById("reward-close");
        const feedbackBtn = document.getElementById("btn-feedback");
        const feedbackForm = document.getElementById("feedback-form");
        const feedbackMessage = document.getElementById("feedback-message");
        const backgroundMusic = document.getElementById("background-music");
        const timeProgressBar = document.getElementById("time-progress-bar");
        const statisticsModal = document.getElementById("statistics-modal");
        const statisticsCloseBtn = document.getElementById("statistics-close");
        const monthlyChart = document.getElementById("monthly-chart");
        const infoToggleBtn = document.getElementById("infoToggleBtn");
        const infoPanel = document.getElementById("infoPanel");
        const closeInfoBtn = document.getElementById("closeInfoBtn");
        const overlay = document.getElementById("overlay");
        const googleSignInButton = document.getElementById("googleSignInButton");
        const googleLogoutBtn = document.getElementById("googleLogoutBtn");
        const userAvatar = document.getElementById("userAvatar");
        const logoutConfirmModal = document.getElementById("logout-confirm-modal");
        const logoutYesBtn = document.getElementById("logout-yes-btn");
        const logoutNoBtn = document.getElementById("logout-no-btn");
        const btnUseReward = document.getElementById("btn-use-reward");
        const btnStatistics = document.getElementById("btn-statistics");

        // Các phần tử thống kê
        const totalSessionsEl = document.getElementById("total-sessions");
        const totalMinutesEl = document.getElementById("total-minutes");
        const avgSessionEl = document.getElementById("avg-session");
        const successRateEl = document.getElementById("success-rate");

        // Các hàm chức năng
        function updateCakeDisplay() {
            const cake = cakes[selectedCake];
            cakeImageEl.src = cake.img;
            cakeImageEl.alt = cake.alt;
            selectedCakeNameEl.textContent = cake.name;
        }

        function updateStartButtonState() {
            const h = Math.min(Math.max(parseInt(inputHour.value) || 0, 0), 23);
            const m = Math.min(Math.max(parseInt(inputMinute.value) || 0, 0), 59);
            const s = Math.min(Math.max(parseInt(inputSecond.value) || 0, 0), 59);
            const hasTime = h + m + s > 0 || elapsedSeconds > 0;
            const hasCake = !!selectedCake;
            
            btnStartStop.disabled = !(hasTime && hasCake);
            
            if (isRunning) {
                btnStartStop.textContent = "Dừng lại";
                btnStartStop.classList.remove("bg-[#9BBA74]", "hover:bg-[#8aa85a]");
                btnStartStop.classList.add("bg-[#DC143C]", "hover:bg-[#b0102a]");
            } else {
                btnStartStop.textContent = "Bắt đầu";
                btnStartStop.classList.remove("bg-[#DC143C]", "hover:bg-[#b0102a]");
                btnStartStop.classList.add("bg-[#9BBA74]", "hover:bg-[#8aa85a]");
            }
        }

        function parseTimeInputs() {
            return {
                h: Math.min(Math.max(parseInt(inputHour.value) || 0, 0), 23),
                m: Math.min(Math.max(parseInt(inputMinute.value) || 0, 0), 59),
                s: Math.min(Math.max(parseInt(inputSecond.value) || 0, 0), 59),
            };
        }

        function totalSeconds(time) {
            return time.h * 3600 + time.m * 60 + time.s;
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = seconds % 60;
            return (
                (h > 0 ? String(h).padStart(2, "0") + ":" : "") +
                String(m).padStart(2, "0") +
                ":" +
                String(s).padStart(2, "0")
            );
        }

        function updateTimeInputsFromRemaining() {
            const h = Math.floor(remainingSeconds / 3600);
            const m = Math.floor((remainingSeconds % 3600) / 60);
            const s = remainingSeconds % 60;
            inputHour.value = h > 0 ? h : "";
            inputMinute.value = m > 0 || h > 0 ? m : "";
            inputSecond.value = s > 0 || m > 0 || h > 0 ? s : "";
        }

        function updateProgressBar() {
            if (selectedTimeTotalSeconds === 0) {
                timeProgressBar.style.width = "0%";
                return;
            }
            const percent = (remainingSeconds / selectedTimeTotalSeconds) * 100;
            timeProgressBar.style.width = percent + "%";
        }

        let selectedTimeTotalSeconds = 0;
        function startTimer() {
            if (isRunning) return;
            if (elapsedSeconds === 0) {
                selectedTime = parseTimeInputs();
                selectedTimeTotalSeconds = totalSeconds(selectedTime);
                remainingSeconds = selectedTimeTotalSeconds;
            } else { 
                remainingSeconds = selectedTimeTotalSeconds - elapsedSeconds;
            }
            if (remainingSeconds <= 0) return;
            isRunning = true;
            updateStartButtonState();
            cookingGif.classList.remove("hidden");
            cakeImageEl.classList.add("hidden");
            backgroundMusic.play().catch(() => {});
            updateTimeInputsFromRemaining();
            updateProgressBar();
            timerInterval = setInterval(() => {
                remainingSeconds--;
                elapsedSeconds++;
                updateTimeInputsFromRemaining();
                updateProgressBar();
                if (remainingSeconds <= 0) {
                    stopTimer(true);
                }
            }, 1000);
            disableInputs(true);
        }

        function stopTimer(finished = false) {
            if (!isRunning) return;
            isRunning = false;
            clearInterval(timerInterval);
            timerInterval = null;
            cookingGif.classList.add("hidden");
            cakeImageEl.classList.remove("hidden");
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
            disableInputs(false);
            if (finished) {
                saveSessionHistory(elapsedSeconds);
                showReward(elapsedSeconds);
                resetTimerState();
            } else {
                updateStartButtonState();
            }
        }

        function resetTimerState() {
            elapsedSeconds = 0;
            selectedTimeTotalSeconds = 0;
            inputHour.value = "";
            inputMinute.value = "";
            inputSecond.value = "";
            timeProgressBar.style.width = "100%";
            updateStartButtonState();
        }

        function disableInputs(disable) {
            inputHour.disabled = disable;
            inputMinute.disabled = disable;
            inputSecond.disabled = disable;
            circleCakeBtn.disabled = disable;
            document.getElementById("btn-statistics").disabled = disable;
        }

        function showReward(elapsed) {
            const timeMinutes = elapsed / 60;
            let rewards = [];
            let rewardName = "";
            if (timeMinutes < 3) {
                rewards = [{
                    type: "cake",
                    name: "bánh nướng bóng đêm",
                    img: cakes["bánh nướng bóng đêm"].img,
                    alt: cakes["bánh nướng bóng đêm"].alt,
                }];
                rewardName = "bánh nướng bóng đêm";
            } else {
                rewards = [{
                    type: "cake",
                    name: selectedCake,
                    img: cakes[selectedCake].img,
                    alt: cakes[selectedCake].alt,
                }];
                rewardName = selectedCake;
            }

            let rewardInventoryLocal = JSON.parse(localStorage.getItem("rewardInventory")) || [];
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10);
            const timeStr = now.toTimeString().slice(0, 5);

            rewards.forEach(r => {
                const rewardWithDate = {
                    ...r,
                    date: dateStr,
                    time: timeStr,
                    durationMinutes: Math.floor(elapsed / 60),
                    id: Date.now() + Math.random(),
                };
                rewardInventoryLocal.push(rewardWithDate);
            });
            localStorage.setItem("rewardInventory", JSON.stringify(rewardInventoryLocal));
            rewardInventory = rewardInventoryLocal;

            rewardContent.innerHTML = "";
            rewards.forEach((r) => {
                const div = document.createElement("div");
                div.className = "flex flex-col items-center space-y-1";
                const img = document.createElement("img");
                img.src = r.img;
                img.alt = r.alt;
                img.className = "w-[56px] h-[56px] object-contain";
                img.draggable = false;
                const span = document.createElement("span");
                span.className = "text-gray-800 font-semibold text-center text-sm";
                span.textContent = r.name;
                div.appendChild(img);
                div.appendChild(span);
                rewardContent.appendChild(div);
            });
            const textLine = document.createElement("p");
            textLine.className = "text-center font-semibold text-lg text-gray-900 mt-2";
            textLine.textContent = "Hoan hô! Bạn đã nhận được " + rewards.map((r) => r.name).join(", ") + ".";
            rewardContent.appendChild(textLine);

            rewardModal.classListContent.appendChild(textLine);

            rewardModal.classList.remove("hidden");
        }

        function saveSessionHistory.remove("hidden");
        }

        function saveSessionHistory(elapsedSeconds(elapsedSeconds)) {
 {
            if (elapsedSeconds <=            if (elapsedSeconds <= 0) return;
            const now 0) return;
            const now = new Date();
 = new Date();
            const            const dateStr = now dateStr = now.toISOString().slice(0, 10.toISOString().slice(0, 10);
            const time);
            const timeStr = now.toStr = now.toTimeString().slice(0TimeString().slice, 5);
            const(0, 5);
            const new newSession = {
                id: DateSession = {
                id: Date.now(),
.now(),
                name:                name: selected selectedCake,
               Cake,
                time: timeStr,
                time: timeStr,
                date: dateStr date: dateStr,
                timeSeconds,
                timeSeconds: elapsedSeconds,
               : elapsedSeconds,
                durationMinutes: Math.floor(elapsedSeconds / durationMinutes: Math.floor(elapsed 60),
               Seconds / 60),
                image: cakes image: cakes[selectedCake].[selectedCake].img,
            };
           img,
            };
 sessionHistory.push(newSession);
            localStorage.set            sessionHistory.push(newSession);
            localStorage.setItem("sessionHistoryItem("sessionHistory",", JSON.stringify(session JSON.stringify(sessionHistory));
        }

       History));
        }

        function renderCake function renderCakeMenu()Menu() {
            const menuCake {
            const menuList = documentCakeList = document.getElementById("menu-cake.getElementById("menu-cake-list");
-list");
            menuCakeList.innerHTML = "";
            menuCakeList.innerHTML = "";
            Object.keys(c            Object.keys(cakes).forEach(cakeNameakes).forEach(cakeName => {
                if => {
                if (cakeName.trim (cakeName.trim() === "b() === "bánánh nướngh nướng b bóng đêmóng đêm") return") return;
                const cake = cakes;
                const cake = cakes[c[cakeName];

akeName];

                const btn = document.createElement("                const btn = document.createElement("button");
                btn.typebutton");
                btn.type = = "button";
                btn "button";
                btn.className = "flex.className = "flex flex-col items-center space-y-1 focus flex-col items-center space-y-1 focus:outline-none focus:ring:outline-none focus:ring-2-2 focus:ring-[#9BBA focus:ring-[#9BBA74] rounded";
               74] rounded";
                btn.setAttribute(" btn.setAttribute("datadata-cake",-cake", cakeName);
                btn.setAttribute cakeName);
                btn("aria-label",.setAttribute("aria-label", `Ch `Chọn mọn món ${cakeNameón ${cakeName}`}`);

                const img = document.createElement);

                const img = document.createElement("img("img");
                img.src");
                img.src = cake = cake.img;
.img;
                img                img.alt = cake.alt = cake.alt;
                img.alt;
                img.className = ".className = "ww-14 h-14 h-14 object-contain";
-14 object-contain";
                img.dra                img.draggableggable = false = false;

               ;

                const span = document.createElement("span");
 const span = document.createElement("span");
                               span.class span.className = "Name = "text-smtext-sm font-semibold text-gray- font-semibold text-gray-700";
700";
                span.text                span.textContent =Content = cakeName;

                btn.appendChild(img);
 cakeName;

                btn.appendChild(img);
                btn                btn.appendChild(span);

                btn.appendChild(span);

                btn.addEventListener("click",.addEventListener("click", () () => {
                    if => {
                    if (isRunning) return;
 (isRunning) return;
                    selectedC                    selectedCake =ake = cakeName;
                    cakeName;
                    updateCakeDisplay updateCakeDisplay();
                    menuSelectCake();
                    menuSelectCake.classList.add("hidden");
                    updateStart.classList.add("hidden");
                    updateStartButtonState();
               ButtonState();
                });

                menuCakeList });

                menuCakeList.appendChild(.appendChild(btnbtn);
);
            });
        }

        function render            });
        }

        function renderMonthlyChart() {
            monthlyChartMonthlyChart() {
            monthlyChart.innerHTML =.innerHTML = '';
            
            const sessionHistory = JSON '';
            
            const sessionHistory = JSON.parse(localStorage.getItem('sessionHistory')) || [];
            
           .parse(localStorage.getItem('sessionHistory')) || [];
            
            if (session if (sessionHistory.length === 0) {
                monthlyChart.innerHTML =History.length === 0) {
                monthlyChart.innerHTML = '<p '<p class=" class="text-center text-gray-500text-center text-gray-500">Chưa">Chưa có có dữ li dữ liệu thệu thống kống kê theo tháng</pê theo tháng</p>';
                updateMonthly>';
                updateMonthlyStatsStats(0,(0, 0 0, , 0, 00, 0);
                return;
            }
            
);
                return;
            }
            
            const monthly            const monthlyData =Data = {};
            {};
            const currentDate = new Date();
            const currentDate = new Date();
            const current const currentMonth =Month = currentDate currentDate.getMonth();
            const currentYear.getMonth();
            const currentYear = current = currentDate.getFullYear();
Date.getFullYear();
            
            let totalSessions            
            let totalSessions =  = 0;
            let0;
            let totalMinutes = 0;
 totalMinutes =             let successfulSessions = 0;
            
            // Lọc dữ liệu trong 6 tháng gần đây
            for (let i = 5; i >= 0; i--) {
                const date = new Date(currentYear, currentMonth - i, 10;
            let successfulSessions = 0;
            
            // Lọc dữ liệu trong 6 tháng gần đây
            for (let i = 5; i >= 0; i--) {
                const date = new Date(currentYear, currentMonth - i);
                const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                monthlyData[monthYear] = 0;
            }
            
            // Tính tổng thời gian theo tháng
            sessionHistory.forEach(session => {
                const sessionDate = new Date(session.date, 1);
                const monthYear = `${date.getMonth() + 1}/${date.getFullYear()}`;
                monthlyData[monthYear] = 0;
            }
            
            // Tính tổng thời gian theo tháng
            sessionHistory.forEach(session => {
                const sessionDate = new Date(session.date);
                const monthYear = `${sessionDate.getMonth() + 1}/${sessionDate.getFullYear()}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = 0;
                }
                
                monthlyData[monthYear] += session.durationMinutes || 0;
);
                const monthYear = `${sessionDate.getMonth() + 1}/${sessionDate.getFullYear()}`;
                
                if (!monthlyData[monthYear]) {
                    monthlyData[monthYear] = 0;
                }
                
                monthlyData[monthYear] += session.durationMinutes || 0;
                
                // Tính tổng số cho tháng hiện tại
                if (sessionDate.getMonth() === currentMonth && sessionDate.getFullYear                
                // Tính tổng số cho tháng hiện tại
                if (sessionDate.getMonth() === currentMonth && sessionDate.getFullYear() === currentYear) {
                    totalSessions++;
                    totalMinutes += session.durationMinutes || 0;
                    if (session.durationMinutes >= 5)() === currentYear) {
                    totalSessions++;
                    totalMinutes += session.durationMinutes || 0;
                    if (session.durationMinutes >= 5) {
                        successfulSessions++;
                    }
                }
            });
            
            const months = Object.keys(monthlyData);
            const values = Object.values(monthlyData {
                        successfulSessions++;
                    }
                }
            });
            
            const months = Object.keys(monthlyData);
            const values = Object.values(monthlyData);
            
            if (months.length === 0) {
                monthlyChart.innerHTML = '<p class="text-center text-gray-500">);
            
            if (months.length === 0) {
                monthlyChart.innerHTML = '<p class="text-center text-gray-500Chưa có dữ liệu thống kê theo tháng</p>';
                return;
            }
            
            const maxValue = Math.max(...values);
            const chartHeight = ">Chưa có dữ liệu thống kê theo tháng</p>';
                return;
            }
            
            const maxValue = Math.max(...values);
            const chartHeight = 200;
            const barWidth = 30;
            const spacing = 40;
            const chartWidth = months.length * (barWidth200;
            const barWidth = 30;
            const spacing = 40;
            const chartWidth = months.length * (barWidth + spacing);
            
            monthlyChart.style + spacing);
            
            monthlyChart.style.width = `${chart.width = `${chartWidth}px`;
            
           Width}px`;
 months.forEach((month            
            months.forEach((month, index), index) => {
                const value => {
                const value = values[index];
                const = values[index];
 barHeight = max                const barHeight = maxValue > 0 ? (value /Value > 0 ? (value / maxValue) maxValue) * chart * chartHeight : Height : 0;
                
                const bar0;
                
                const barContainer =Container = document document.createElement('div');
                barContainer.createElement('div');
                barContainer.className =.className = 'chart-bar 'chart-bar-container';
               -container';
                barContainer.style.position = ' barContainer.style.position = 'absolute';
                barContainer.style.left =absolute';
                barContainer.style.left = `${index * (bar `${index * (barWidth + spacing)}px`;
Width + spacing)}px`;
                bar                barContainer.style.width = `${barContainer.style.width = `${barWidth}px`;
Width}px`;
                               barContainer.style barContainer.style.height = `${chartHeight}.height = `${chartHeight}px`;
                
               px`;
                
                const bar = document const bar = document.createElement('div');
                bar.className =.createElement('div');
                bar.className 'chart-bar';
                bar = 'chart-bar';
                bar.style.height =.style.height = `${barHeight}px`;
 `${barHeight}px`;
                bar.style.backgroundColor                bar.style.backgroundColor = '#9B = '#9BBA74';
                bar.title = `${month}:BA74';
                bar.title = `${month}: ${value} phút`;
                
                const value ${value} phút`;
                
                const valueLabel =Label = document.createElement('div');
                document.createElement('div');
                valueLabel.className valueLabel.className = = 'chart-value 'chart-value';
                valueLabel.textContent';
                valueLabel.textContent = value;
                
 = value;
                
                const monthLabel = document                const monthLabel.createElement('div');
                month = document.createElement('div');
                monthLabel.classNameLabel.className = = 'chart-label';
                monthLabel.text 'chart-label';
                monthLabel.textContent =Content = month;
 month;
                
                barContainer.appendChild(                
                barContainer.appendChild(bar);
                barContainer.appendChild(valueLabelbar);
                barContainer.appendChild(valueLabel);
);
                barContainer                barContainer.appendChild(monthLabel);
                
.appendChild(monthLabel);
                
                monthlyChart.appendChild                monthlyChart.appendChild(bar(barContainer);
Container);
            });
            
            // Cập            });
            
            // Cập nh nhật thống kật thống kê tháng
            constê tháng
            const avgSession = total avgSession = totalSessions > 0 ? Math.round(totalMinutesSessions > 0 ? Math.round(totalMinutes / totalSessions / totalSessions) : 0;
) : 0;
                       const successRate = const successRate = totalSessions > 0 totalSessions > 0 ? Math ? Math.round((successfulSessions.round((successfulSessions / totalSessions / totalSessions) * 100) * 100) : 0;
            
) : 0;
            
            updateMonthlyStats            updateMonthlyStats(totalSessions,(totalSessions, totalMinutes, avg totalMinutes, avgSession, successSession, successRate);
        }
        
        function updateMonthlyStats(sRate);
        }
        
        function updateMonthlyStats(sessions, minutes, avg, rate) {
essions, minutes, avg, rate) {
            totalSessionsEl.textContent =            totalSessionsEl.textContent = sessions;
            total sessions;
            totalMinutesEl.textContent = minutesMinutesEl.textContent = minutes;
            avgSession;
            avgSessionEl.textContent =El.textContent = avg;
            successRate avg;
            successRateEl.textContent =El.textContent = `${rate}%`;
 `${rate}%`;
        }

        function        }

        function updateLoginButtonUI updateLoginButtonUI() {
            if (() {
            if (googleUser)googleUser) {
                googleSignInButton {
                googleSignInButton.style.display = ".style.display = "nonenone";
                googleLogoutBtn.style";
                googleLogoutBtn.style.display =.display = "flex";
 "flex";
                userAvatar.src =                userAvatar.src = googleUser.p googleUser.picture;
                userAvatar.icture;
                userAvataralt = `Ả.alt = `Ảnh đnh đại diện của ${googleại diện của ${googleUser.name}`;
User.name}`;
                userAvatar.classList.remove("                userAvatar.classList.remove("hidden");
hidden");
                googleLogout                googleLogoutBtn.title = "ĐăngBtn.title = "Đăng xuất tài xuất tài khoản Google";
            } else {
 khoản Google";
            } else {
                googleSignInButton.style                googleSignInButton.style.display = "flex.display = "flex";
";
                googleLogoutBtn.style.display = "none";
                user                googleLogoutBtn.style.display = "none";
                userAvatar.classListAvatar.classList.add("hidden");
                user.add("hidden");
                userAvatar.src = "";
Avatar.src = "";
                user                userAvatar.alt = "";
            }
Avatar.alt = "";
            }
        }

               }

        function initialize function initializeGoogleSignIn()GoogleSignIn() {
            google. {
            google.accounts.id.initializeaccounts.id.initialize({
                client_id: "({
                client_id: "854854945467513945467513-gvec4958ef17nq-gvec4958ef17nqjsoauvk9dcjsoauvk9dcqinceeelqinceeel.apps.googleusercontent.apps.googleusercontent.com",
                callback.com",
                callback: handleCredentialResponse,
: handleCredentialResponse,
                auto_select:                auto_select: false,
                cancel false,
                cancel_on_tap_out_on_tap_outside: false
           side: false
            });
            google });
            google..accounts.id.renderButtonaccounts.id.renderButton(
                googleSignIn(
                googleSignInButton,
                {Button,
                { theme: "filled_green theme: "filled", size: "medium", width: _green", size: "medium", width: 160, height160, height: : 40 }
            );
        }

40 }
            );
        }

        function handleCred        function handleCredentialentialResponse(response)Response(response) {
            {
            const data = parseJwt(response. const data = parseJwt(response.credential);
            googleUser = {
credential);
            googleUser = {
                id: data.sub,
                name: data                id: data.sub,
                name: data.name,
                email: data.email,
.name,
                email: data.email,
                picture: data.p                picture: data.pictureicture
            };
            localStorage.setItem("
            };
            localStorage.setgoogleuser", JSON.stringify(googleUserItem("googleuser", JSON.stringify(googleUser));
            updateLogin));
            updateLoginButtonUI();
            alert("BạnButtonUI();
            alert(" đã đăngBạn đã đăng nhập thành công: " nhập thành công: " + googleUser.name + googleUser.name);
        }

       );
        }

        function parseJwt function parseJwt(token) {
            try {
(token) {
            try {
                const base64                const base64Url = token.split('.Url = token.split('.')[1];
')[1];
                const base64 = base                const base64 = base64Url.replace(64Url.replace(/-/g, '+').replace(/-/g, '+').replace(/_/g, '/');
/_/g, '/');
                const jsonPayload                const jsonPayload = decodeURIComponent = decodeURIComponent(atob(base64(atob(base64).split('').map(function).split('').map(function(c) {
                   (c) {
                    return '%' + return '%' + ('00' + ('00' + c.charCodeAt(0 c.charCodeAt(0).toString(16)).slice(-2);
               ).toString(16)).slice(-2);
                }).join(' }).join(''));
                return JSON.parse(json'));
                return JSON.parsePayload);
            } catch {
                return {};
(jsonPayload);
            } catch {
                return {};
            }
            }
        }

        function        }

        function openPanel() {
 openPanel() {
            infoPanel.classList            infoPanel.classList.remove("scale-0");
.remove("scale-0            infoPanel.setAttribute("aria-hidden");
            infoPanel.setAttribute("aria-hidden", "false");
", "false");
            overlay.classList.remove            overlay.classList.remove("hidden");
        }

       ("hidden");
        }

        function closePanel() function closePanel() {
            infoPanel {
            infoPanel.classList.add("scale-.classList.add("scale-0");
            infoPanel0");
            infoPanel.setAttribute("aria.setAttribute("aria-hidden", "true");
           -hidden", "true");
            overlay.classList.add overlay.classList.add("("hidden");
        }

        // Gánhidden");
        }

        // Gán sự kiện sự kiện
        inputHour
        inputHour.addEventListener("input", () =>.addEventListener("input", () => {
            if (inputHour.value.length > 2) inputHour.value = inputHour.value.slice(0, 2);
            updateStartButton {
            if (inputHour.value.length > 2) inputHour.value = inputHour.value.slice(0, 2);
            updateStartButtonState();
State();
        });
        inputMinute        });
        inputMinute.addEventListener(".addEventListener("inputinput", () => {
            if (inputMinute.value.length > 2) inputMinute.value = input", () => {
            if (inputMinute.value.length > 2) inputMinute.value = inputMinute.value.slice(0, 2Minute.value.slice(0, 2);
            updateStartButtonState();
);
            updateStartButtonState();
        });
        inputSecond.addEventListener("input", () => {
                   });
        inputSecond.addEventListener("input", () => {
            if (inputSecond if (inputSecond.value.length > .value.length > 2) inputSecond2) inputSecond.value =.value = inputSecond.value.slice(0 inputSecond.value.slice(0, 2);
, 2);
            updateStartButtonState();
        });

            updateStartButtonState();
        });

        btnStartStop        btnStartStop.addEventListener("click", () =>.addEventListener("click", () => {
            {
            if ( if (isRunning) {
                stopTimer(falseisRunning) {
                stopTimer(false);
            } else);
            } {
                startTimer();
            }
        });

        else {
                startTimer();
            }
        });

        circleCakeBtn circleCakeBtn.addEventListener("click", () =>.addEventListener("click", () => {
            {
            if (isRunning) return if (isRunning) return;
            menu;
            menuSelectCake.classList.tSelectCake.classList.toggle("hidden");
oggle("hidden");
        });

        rewardCloseBtn        });

        rewardCloseBtn.addEventListener(".addEventListener("click", () => {
            rewardModalclick", () => {
            rewardModal.classList.add("hidden.classList.add("hidden");
        });

        feedbackBtn");
        });

        feedbackBtn.addEventListener(".addEventListener("click", () => {
            constclick", () => {
            const message = prompt message = prompt("V("Vui lòng nhập gópui lòng nhập góp ý của bạn:");
 ý của bạn:");
            if (message            if (message === null) return;
            === null) return;
            if (message if (message.trim() === "") {
.trim() === "") {
                alert("V                alert("Vui lòng nhập nui lòng nhập nội dungội dung g góp ýóp ý.");
                return;
            }
.");
                return;
            }
            feedbackMessage.value = message.trim();
            feedbackForm            feedbackMessage.value = message.trim();
            feedbackForm.submit();
        });

       .submit();
        });

        btnStatistics.addEventListener('click', () => {
            btnStatistics.addEventListener('click', () => {
            if (isRunning) if (isRunning) return;
            render return;
            renderMonthlyChartMonthlyChart();
            statisticsModal.classList.remove("hidden();
            statisticsModal.classList.remove("hidden");
");
        });

               });

        statisticsCloseBtn.addEventListener('click statisticsCloseBtn.addEventListener('click', () => {
            statisticsModal', () => {
            statisticsModal.classList.add.classList.add("hidden("hidden");
        });

        infoToggleBtn");
        });

        infoToggle.addEventListener("click", () => {
           Btn.addEventListener("click", () => {
            if (infoPanel if (infoPanel.classList.contains("scale-0.classList.contains("scale-0")) {
                open")) {
                openPanel();
            } else {
Panel();
            } else {
                close                closePanel();
            }
        });

Panel();
            }
        });

        closeInfoBtn.addEventListener("click",        closeInfoBtn.addEventListener("click", close closePanel);

       Panel);

        overlay.addEventListener overlay.addEventListener("click", closePanel);

        googleLogoutBtn("click", closePanel);

        googleLogoutBtn.addEventListener("click.addEventListener("click", () => {
", () => {
            logoutConfirmModal.classList            logoutConfirmModal.classList.remove.remove("hidden");
        });

        logoutYesBtn("hidden");
        });

        logoutYesBtn.addEventListener("click", ().addEventListener("click", () => {
            google => {
            googleUser = null;
User = null;
            localStorage.removeItem("            localStorage.removeItem("googleuser");
           googleuser");
            updateLoginButton updateLoginButtonUI();
            logoutConfirmModal.classListUI();
            logoutConfirmModal.classList.add.add("hidden");
            alert("Bạn("hidden");
            alert("Bạn đã đăng xuất.");
        });

        đã đăng xuất.");
        });

        logoutNoBtn.addEventListener("click logoutNoBtn.addEventListener("click", () => {
            logoutConfirmModal", () => {
            logoutConfirmModal.classList.add("hidden");
.classList.add("hidden");
        });

        btnUseReward.addEventListener("        });

        btnUseReward.addEventListener("click", () => {
            alert("click", () => {
            alert("Tính năng sử dụng phần thTính năng sửưởng đang được phát tri dụng phần thưởng đang được phát triển!");
        });

        //ển!");
        });

        // Khở Khởi tạo ứng dụng
i tạo ứng dụng
        window.addEventListener("        window.addEventListener("load", () => {
           load", () => {
            updateCakeDisplay updateCakeDisplay();
            updateStartButtonState();
           ();
            updateStartButtonState();
            renderCakeMenu();
            renderCakeMenu();
            updateLoginButtonUI updateLoginButtonUI();
            timeProgressBar.style();
            timeProgressBar.style.width = ".width = "100%";
100%";
            initializeGoogleSignIn();
            
                       initializeGoogleSignIn();
            
            // Đảm bảo sessionHistory tồn // Đảm bảo sessionHistory tồn tại trong localStorage
            if (!localStorage.getItem tại trong localStorage
            if (!localStorage.getItem('sessionHistory')) {
                localStorage.set('sessionHistory')) {
                localStorage.setItem('Item('sessionHistory', JSON.stringify([]));
           sessionHistory', JSON.stringify([]));
            }
            
            // Xóa }
            
            // Xóa các inventory các inventory không cần thiết
 không cần thiết
            localStorage.removeItem            localStorage.removeItem('cakeinventory');
           ('cakeinventory localStorage.removeItem('plateinventory');
            localStorage');
            localStorage.removeItem('plateinventory');
            localStorage.removeItem.removeItem('decorinventory');
        });
('decorinventory');
        });
    </script>
    </script>
</body>
</body>
</html>
