   <html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trang-chủ - Ứng dụng tập trung</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f0f3e8;
    }
    /* Scrollbar for menu */
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    .scrollbar-thin::-webkit-scrollbar-track {
      background: transparent;
    }
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background-color: #9bba74;
      border-radius: 3px;
    }
    /* Statistics modal content: no grid, just images in a row wrapping naturally */
    #cake-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 70vh;
      overflow-y: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: flex-start;
      align-items: center;
    }
    #cake-list li {
      background: transparent;
      padding: 0;
      cursor: pointer;
      outline: none;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      border-radius: 0.5rem;
    }
    #cake-list li:focus,
    #cake-list li:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgb(0 0 0 / 0.2);
      z-index: 10;
    }
    #cake-list li img {
      width: 64px;
      height: 64px;
      object-fit: contain;
      border-radius: 0.5rem;
      user-select: none;
      pointer-events: none;
      display: block;
    }
    #cake-list li span {
      display: none;
    }
    @media (max-width: 480px) {
      #cake-list li img {
        width: 48px;
        height: 48px;
      }
    }
    #user-info img {
      width: 48px;
      height: 48px;
      border-radius: 9999px;
      margin-top: 0.25rem;
    }
  </style>
</head>
<body class="relative min-h-screen flex flex-col items-center bg-[#f0f3e8]">
  <!-- Background Image -->
  <img
    src="https://i.ibb.co/JRr5YSFS/66-F84-D93-7422-4-D12-AD64-8-B3103-E20-BD3.png"
    alt="Background with soft green and beige abstract shapes, watercolor style, gentle and calming atmosphere"
    class="fixed inset-0 w-full h-full object-cover -z-10"
  />

  <!-- Header with Google Login / Logout Button -->
  <header class="w-full flex justify-end p-4 max-w-screen-md">
    <button
      id="googleLoginBtn"
      aria-label="Đăng nhập hoặc đăng xuất tài khoản Google"
      class="flex items-center justify-center w-10 h-10 rounded-full bg-[#9BBA74] hover:bg-[#8aa85a] text-white font-semibold shadow focus:outline-none focus:ring-2 focus:ring-[#8aa85a]"
      type="button"
      title="Đăng nhập hoặc đăng xuất"
    >
      <span id="loginIcon" class="text-lg font-bold select-none">G</span>
      <i id="logoutIcon" class="fas fa-arrow-right hidden"></i>
    </button>
  </header>

  <!-- Google Sign-In -->
  <div id="g_id_onload"
       data-client_id="854945467513-gvec4958ef17nqjsoauvk9dcqinceeel.apps.googleusercontent.com"
       data-callback="handleCredentialResponse"
       data-auto_prompt="false">
  </div>
  <div class="g_id_signin" data-type="standard"></div>

  <!-- Thông tin người dùng -->
  <div id="user-info" class="mt-2 text-center text-gray-800 font-semibold"></div>

  <!-- Main Content -->
  <main
    class="flex-grow flex flex-col items-center justify-center px-4 pb-20 relative w-full max-w-screen-md"
    aria-label="Màn hình chính ứng dụng tập trung"
  >
    <!-- Time selector rectangle above circle with progress bar -->
    <div
      id="time-selector"
      class="mb-6 w-full max-w-xs rounded-lg border-4 border-[#9BBA74] bg-white bg-opacity-90 p-4 flex flex-col select-none"
      aria-label="Chọn thời gian giờ phút giây"
    >
      <div class="relative w-full h-10 rounded bg-gray-200 overflow-hidden mb-2" aria-hidden="true">
        <div id="time-progress-bar" class="absolute left-0 top-0 h-10 bg-[#9BBA74] transition-all duration-500 ease-linear" style="width: 100%;"></div>
      </div>
      <div class="flex justify-center space-x-2 z-10 relative">
        <input
          type="number"
          id="input-hour"
          min="0"
          max="23"
          placeholder="Giờ"
          class="w-16 text-center rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] text-lg font-semibold bg-transparent"
          aria-label="Giờ"
        />
        <span class="text-xl font-semibold text-gray-700 select-none">:</span>
        <input
          type="number"
          id="input-minute"
          min="0"
          max="59"
          placeholder="Phút"
          class="w-16 text-center rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] text-lg font-semibold bg-transparent"
          aria-label="Phút"
        />
        <span class="text-xl font-semibold text-gray-700 select-none">:</span>
        <input
          type="number"
          id="input-second"
          min="0"
          max="59"
          placeholder="Giây"
          class="w-16 text-center rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] text-lg font-semibold bg-transparent"
          aria-label="Giây"
        />
      </div>
    </div>

    <!-- Circle with selected cake image -->
    <button
      id="circle-cake"
      aria-label="Chọn món ăn"
      class="relative rounded-full border-8 border-[#9BBA74] w-56 h-56 flex items-center justify-center overflow-hidden shadow-lg bg-white"
      type="button"
    >
      <img
        id="cake-image"
        src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/00CC2FB6-9ED5-4466-9DDB-C7B89C391BB1.png"
        alt="Hình ảnh Macaron màu hồng pastel, bánh ngọt tròn nhỏ xinh xắn, nền trắng"
        class="w-40 h-40 object-contain"
        draggable="false"
      />
      <!-- GIF overlay hidden by default -->
      <img
        id="cooking-gif"
        src="https://i.ibb.co/S4dcjq9g/Video.gif"
        alt="Hình ảnh GIF hoạt hình bánh đang được nấu, màu sắc tươi sáng, nền trong suốt"
        class="absolute inset-0 w-full h-full object-contain hidden"
        draggable="false"
      />
    </button>

    <!-- Selected cake name rectangle below circle -->
    <div
      id="selected-cake-name"
      class="mt-6 w-full max-w-xs rounded-lg border-4 border-[#9BBA74] bg-white bg-opacity-90 p-3 text-center text-xl font-semibold text-gray-800 select-none min-h-[3rem]"
      aria-live="polite"
      aria-atomic="true"
    >
      Macaron
    </div>

    <!-- Bottom rectangle with buttons -->
    <div
      class="mt-6 w-full max-w-xs rounded-lg border-4 border-[#9BBA74] bg-white bg-opacity-90 p-4 flex items-center justify-between"
      aria-label="Các nút điều khiển"
    >
      <!-- Left side buttons -->
      <div class="flex space-x-4">
        <button
          id="btn-statistics"
          aria-label="Bảng thống kê dạng lưới"
          class="w-11 h-11 rounded-full bg-[#9BBA74] hover:bg-[#8aa85a] flex items-center justify-center text-white shadow focus:outline-none focus:ring-2 focus:ring-[#8aa85a]"
          type="button"
        >
          <i class="fas fa-chart-bar text-lg"></i>
        </button>
      </div>

      <!-- Center Start/Stop/Use Reward button -->
      <button
        id="btn-start-stop"
        class="flex-1 mx-4 py-2 rounded-lg font-bold text-white disabled:opacity-50 disabled:cursor-not-allowed bg-[#9BBA74] hover:bg-[#8aa85a] focus:outline-none focus:ring-2 focus:ring-[#8aa85a]"
        type="button"
        aria-live="polite"
        aria-atomic="true"
      >
        Bắt đầu
      </button>

       <!-- Hidden feedback form for submission -->
    <form
      id="feedback-form"
      action="https://formspree.io/f/mzzvylbg"
      method="POST"
      class="hidden"
    >
      <label>
        <input type="email" name="thuyvan01012008@gmail.com" value="madebyvann" />
      </label>
      <input type="hidden" name="message" id="feedback-message" />
    </form>
  </main>

  <!-- Feedback button bottom right -->
  <button
    id="btn-feedback"
    aria-label="Góp ý"
    class="fixed bottom-6 right-6 w-14 h-14 rounded-full bg-[#9BBA74] hover:bg-[#8aa85a] flex items-center justify-center text-white shadow-lg z-50 focus:outline-none focus:ring-2 focus:ring-[#8aa85a]"
    type="button"
    title="Góp ý"
  >
    <i class="fas fa-comment-alt text-xl"></i>
  </button>
  <button
    id="infoToggleBtn"
    aria-label="Toggle information panel"
    class="absolute top-4 left-4 
           p-3 bg-green-600 text-white rounded-full shadow-md 
           hover:bg-green-700 bg-opacity-50 focus:outline-none focus:ring-2 focus:ring-green-400 
           flex items-center justify-center w-12 h-12"
  >
    <i class="fas fa-question text-lg"></i>
  </button>

  <!-- Logout Confirmation Modal -->
  <div
    id="logout-confirm-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="logout-confirm-title"
  >
    <div class="bg-white rounded-lg max-w-sm w-full p-6 flex flex-col space-y-4 shadow-lg">
      <h2 id="logout-confirm-title" class="text-xl font-semibold text-gray-800 text-center">
        Bạn có muốn đăng xuất không?
      </h2>
      <div class="flex justify-center space-x-6">
        <button
          id="logout-yes-btn"
          class="px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold focus:outline-none focus:ring-2 focus:ring-[#b0102a]"
          type="button"
        >
          Có
        </button>
        <button
          id="logout-no-btn"
          class="px-6 py-2 rounded bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold focus:outline-none focus:ring-2 focus:ring-gray-400"
          type="button"
        >
          Không
        </button>
      </div>
    </div>
  </div>

  <!-- Menu chọn món (hidden by default) -->
  <div
    id="menu-select-cake"
    class="fixed bottom-32 left-1/2 transform -translate-x-1/2 w-full max-w-md max-h-60 bg-white bg-opacity-95 rounded-lg border border-gray-300 shadow-lg overflow-y-auto scrollbar-thin hidden z-40"
    role="list"
    aria-label="Menu chọn món ăn"
  >
    <div id="menu-cake-list" class="flex flex-wrap justify-center gap-4 p-4">
      <button type="button" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded" data-cake="Macaron" aria-label="Chọn món Macaron">
        <img src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/00CC2FB6-9ED5-4466-9DDB-C7B89C391BB1.png" alt="Hình ảnh Macaron màu hồng pastel, bánh ngọt tròn nhỏ xinh xắn, nền trắng" class="w-14 h-14 object-contain" draggable="false" />
        <span class="text-sm font-semibold text-gray-700">Macaron</span>
      </button>
      <button type="button" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded" data-cake="bánh mâm xôi" aria-label="Chọn món bánh mâm xôi">
        <img src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/IMG_7293.png" alt="Hình ảnh quả cà tím tím tươi, bóng mượt, nền trắng" class="w-14 h-14 object-contain" draggable="false" />
        <span class="text-sm font-semibold text-gray-700">bánh mâm xôi</span>
      </button>
      <button type="button" class="flex flex-col items-center space-y-1 focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded" data-cake="bánh cherry" aria-label="Chọn món bánh cherry">
        <img src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/B89384A0-0587-48F6-BBCB-4EC98C592F1C.png" alt="Hình ảnh bánh cherry màu đỏ tươi, bánh tròn nhỏ, nền trắng" class="w-14 h-14 object-contain" draggable="false" />
        <span class="text-sm font-semibold text-gray-700">bánh cherry</span>
      </button>
    </div>
  </div>

  <!-- Reward modal -->
  <div
    id="reward-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="reward-title"
  >
    <div
      class="bg-white rounded-lg max-w-md w-full p-6 flex flex-col space-y-4 shadow-lg relative"
    >
      <h2
        id="reward-title"
        class="text-xl font-semibold text-gray-800 text-center"
      >
        Hoan hô! Bạn đã nhận được
      </h2>
      <div
        id="reward-content"
        class="flex flex-row items-center justify-center space-x-4 flex-wrap"
        aria-live="polite"
        aria-atomic="true"
      >
      </div>
      <button
        id="reward-confirm"
        class="mt-4 px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold mx-auto focus:outline-none focus:ring-2 focus:ring-[#b0102a]"
        type="button"
      >
        Xác nhận
      </button>
      <button
        id="reward-close"
        aria-label="Đóng bảng hoan hô"
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 focus:outline-none focus:ring-2 focus:ring-[#b0102a] rounded"
        type="button"
      >
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>
  </div>

  <!-- Statistics modal with scrollable images -->
  <div
    id="statistics-modal"
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden"
    role="dialog"
    aria-modal="true"
    aria-labelledby="statistics-title"
  >
    <div class="bg-white rounded-lg max-w-md w-full p-6 flex flex-col space-y-4 shadow-lg max-h-[90vh] overflow-y-auto">
      <h2 id="statistics-title" class="text-2xl font-bold text-center text-gray-800 mb-4">
        Lịch sử
      </h2>
      <ul id="cake-list" tabindex="0" aria-label="lịch sử tập trung"></ul>
      <div id="session-info" class="mt-4 p-4 bg-gray-100 rounded-lg text-center text-gray-700 min-h-[4rem] select-none" aria-live="polite" aria-atomic="true"></div>
      <button
        id="statistics-close"
        class="mt-4 px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold mx-auto focus:outline-none focus:ring-2 focus:ring-[#b0102a]"
        type="button"
      >
        Đóng
      </button>
    </div>
  </div>

  <!-- Overlay -->
  <div
    id="overlay"
    class="fixed inset-0 bg-black bg-opacity-40 hidden z-40"
  ></div>

  <!-- Info Panel Centered -->
  <aside
    id="infoPanel"
    class="fixed top-1/2 left-1/2 w-80 max-w-full bg-white shadow-lg rounded-lg p-6 transform -translate-x-1/2 -translate-y-1/2 scale-0 transition-transform duration-300 ease-in-out z-50 overflow-y-auto max-h-[80vh]"
    aria-hidden="true"
  >
    <h2 class="text-2xl font-semibold mb-4 text-green-700">Thông tin</h2>
    <p class="mb-4 text-gray-700">
      Thông tin
    </p>
    <ul class="list-disc list-inside space-y-2 text-gray-600">
      <li>1.Sau khi bắt đầu tập trung, không thể thay đổi thời gian.</li>
      <li>2.Cần tập trung từ 5 phút trở lên: nhận được bánh đã chọn.</li>
      <li>3. nếu có góp ý hay thắc mắc nào hãy bấm vào nút bên góc trái </li>
    </ul>
    <button
      id="infoImageBtn"
      type="button"
      aria-label="Nút dẫn tới https://s.shopee.vn/2LOiiEexWq"
      class="mt-2 mx-auto block focus:outline-none focus:ring-2 focus:ring-[#9BBA74] rounded"
      onclick="window.location.href='https://s.shopee.vn/2LOiiEexWq'"
      style="width: 36.8rem; max-width: 100%;"
    >
      <img
        src="https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/4fb2c5e6beca14572e1804fba69eed7455380768/01483ACC-E2E7-46D0-B15C-35BB9D41E3C4.png"
        class="w-full h-auto object-contain"
        draggable="false"
      />
    </button>
    <button
      id="closeInfoBtn"
      class="mt-2 px-6 py-2 rounded bg-[#DC143C] hover:bg-[#b0102a] text-white font-semibold mx-auto block focus:outline-none focus:ring-2 focus:ring-[#b0102a]"
      type="button"
    >
      Đóng
    </button>
  </aside>

  <audio id="background-music" loop preload="auto" src="https://github.com/thuyvannnnnn/Focus-and-frost/raw/refs/heads/main/45.audio.mp3"></audio>

  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <script>
    // Remove cakeinventory, plateinventory, decorinventory from localStorage on load
    localStorage.removeItem('cakeinventory');
    localStorage.removeItem('plateinventory');
    localStorage.removeItem('decorinventory');

    // Data
    const cakes = {
      Macaron: {
        name: "Macaron",
        img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/00CC2FB6-9ED5-4466-9DDB-C7B89C391BB1.png",
        alt: "Hình ảnh Macaron màu hồng pastel, bánh ngọt tròn nhỏ xinh xắn, nền trắng",
      },
      "bánh mâm xôi": {
        name: "bánh mâm xôi",
        img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/IMG_7293.png",
        alt: "Hình ảnh quả cà tím tím tươi, bóng mượt, nền trắng",
      },
      "bánh cherry": {
        name: "bánh cherry",
        img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/B89384A0-0587-48F6-BBCB-4EC98C592F1C.png",
        alt: "Hình ảnh bánh cherry màu đỏ tươi, bánh tròn nhỏ, nền trắng",
      },
      "bánh nướng bóng đêm": {
        name: "bánh nướng bóng đêm",
        img: "https://raw.githubusercontent.com/thuyvannnnnn/Focus-and-frost/main/037F53D1-AC5D-4165-BD08-FEFF3F39FD7D.png",
        alt: "Hình ảnh bánh bị cháy đen, bánh tròn, nền trắng",
      }
    };

    // State
    let selectedCake = "Macaron";
    let selectedTime = { h: 0, m: 0, s: 0 };
    let timerInterval = null;
    let isRunning = false;
    let remainingSeconds = 0;
    let elapsedSeconds = 0; // time already counted before pause
    let rewardInventory = JSON.parse(localStorage.getItem("rewardInventory")) || [];
    let sessionHistory = JSON.parse(localStorage.getItem("sessionHistory")) || [];
    let googleUser = null;

    // Elements
    const cakeImageEl = document.getElementById("cake-image");
    const circleCakeBtn = document.getElementById("circle-cake");
    const selectedCakeNameEl = document.getElementById("selected-cake-name");
    const btnStartStop = document.getElementById("btn-start-stop");
    const inputHour = document.getElementById("input-hour");
    const inputMinute = document.getElementById("input-minute");
    const inputSecond = document.getElementById("input-second");
    const menuSelectCake = document.getElementById("menu-select-cake");
    const menuCakeList = document.getElementById("menu-cake-list");
    const cookingGif = document.getElementById("cooking-gif");
    const rewardModal = document.getElementById("reward-modal");
    const rewardContent = document.getElementById("reward-content");
    const rewardConfirmBtn = document.getElementById("reward-confirm");
    const rewardCloseBtn = document.getElementById("reward-close");
    const feedbackBtn = document.getElementById("btn-feedback");
    const feedbackForm = document.getElementById("feedback-form");
    const feedbackMessage = document.getElementById("feedback-message");
    const backgroundMusic = document.getElementById("background-music");
    const timeProgressBar = document.getElementById("time-progress-bar");

    // Statistics modal elements
    const statisticsModal = document.getElementById("statistics-modal");
    const statisticsCloseBtn = document.getElementById("statistics-close");
    const cakeListEl = document.getElementById("cake-list");
    const sessionInfoEl = document.getElementById("session-info");
    const btnStatistics = document.getElementById("btn-statistics");

  
    // Login/logout button elements
    const googleLoginBtn = document.getElementById("googleLoginBtn");
    const loginIcon = document.getElementById("loginIcon");
    const logoutIcon = document.getElementById("logoutIcon");

    // Logout confirmation modal elements
    const logoutConfirmModal = document.getElementById("logout-confirm-modal");
    const logoutYesBtn = document.getElementById("logout-yes-btn");
    const logoutNoBtn = document.getElementById("logout-no-btn");

    // Info panel elements
    const infoToggleBtn = document.getElementById("infoToggleBtn");
    const infoPanel = document.getElementById("infoPanel");
    const closeInfoBtn = document.getElementById("closeInfoBtn");
    const overlay = document.getElementById("overlay");

    // Functions for info panel
    function openPanel() {
      infoPanel.classList.remove("scale-0");
      infoPanel.setAttribute("aria-hidden", "false");
      overlay.classList.remove("hidden");
    }

    function closePanel() {
      infoPanel.classList.add("scale-0");
      infoPanel.setAttribute("aria-hidden", "true");
      overlay.classList.add("hidden");
    }

    infoToggleBtn.addEventListener("click", () => {
      if (infoPanel.classList.contains("scale-0")) {
        openPanel();
      } else {
        closePanel();
      }
    });

    closeInfoBtn.addEventListener("click", closePanel);

    overlay.addEventListener("click", closePanel);

    // Update login/logout button UI based on login state
    function updateLoginButtonUI() {
      if (googleUser) {
        loginIcon.classList.add("hidden");
        logoutIcon.classList.remove("hidden");
        googleLoginBtn.title = "Đăng xuất tài khoản Google";
        renderUserInfo();
      } else {
        loginIcon.classList.remove("hidden");
        logoutIcon.classList.add("hidden");
        googleLoginBtn.title = "Đăng nhập bằng tài khoản Google";
        clearUserInfo();
      }
    }

    // Render user info below Google Sign-In button
    function renderUserInfo() {
      if (!googleUser) return;
      const userInfoDiv = document.getElementById("user-info");
      userInfoDiv.innerHTML = `
        <p>Xin chào, <b>${googleUser.name}</b>!</p>
        <img src="${googleUser.picture}" alt="Avatar của ${googleUser.name}" />
        <p>Email: ${googleUser.email}</p>
      `;
    }

    function clearUserInfo() {
      const userInfoDiv = document.getElementById("user-info");
      userInfoDiv.innerHTML = "";
    }

    // Initialize Google Sign-In
    function initializeGoogleSignIn() {
      google.accounts.id.initialize({
        client_id: "854945467513-gvec4958ef17nqjsoauvk9dcqinceeel.apps.googleusercontent.com",
        callback: handleCredentialResponse,
        auto_select: false,
        cancel_on_tap_outside: false
      });
      // Try to restore user from localStorage once on init
      const storedUser = localStorage.getItem("googleuser");
      if (storedUser) {
        try {
          googleUser = JSON.parse(storedUser);
        } catch {
          googleUser = null;
          localStorage.removeItem("googleuser");
        }
      }
      updateLoginButtonUI();
    }

    // Handle Google Sign-In response
    function handleCredentialResponse(response) {
      const data = parseJwt(response.credential);
      if (!data || !data.sub) return;
      googleUser = {
        id: data.sub,
        name: data.name,
        email: data.email,
        picture: data.picture
      };
      localStorage.setItem("googleuser", JSON.stringify(googleUser));
      updateLoginButtonUI();
      alert("Bạn đã đăng nhập thành công: " + googleUser.name);
    }

    // Show logout confirmation modal
    function showLogoutConfirm() {
      logoutConfirmModal.classList.remove("hidden");
      overlay.classList.remove("hidden");
    }

    // Hide logout confirmation modal
    function hideLogoutConfirm() {
      logoutConfirmModal.classList.add("hidden");
      overlay.classList.add("hidden");
    }

    // Event listeners for login/logout button
    googleLoginBtn.addEventListener("click", () => {
      if (googleUser) {
        showLogoutConfirm();
      } else {
        google.accounts.id.prompt();
      }
    });

    logoutYesBtn.addEventListener("click", () => {
      googleUser = null;
      localStorage.removeItem("googleuser");
      updateLoginButtonUI();
      hideLogoutConfirm();
      alert("Bạn đã đăng xuất.");
    });

    logoutNoBtn.addEventListener("click", () => {
      hideLogoutConfirm();
    });

    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (!rewardModal.classList.contains("hidden")) rewardModal.classList.add("hidden");
        if (!menuSelectCake.classList.contains("hidden")) menuSelectCake.classList.add("hidden");
        if (!statisticsModal.classList.contains("hidden")) statisticsModal.classList.add("hidden");
        if (!logoutConfirmModal.classList.contains("hidden")) hideLogoutConfirm();
        if (!infoPanel.classList.contains("scale-0")) closePanel();
      }
    });

    // The rest of your existing app logic below (timer, cake selection, etc.) remains unchanged
    // ... (omitted here for brevity, but include all your existing logic)

    // JWT parse helper
    function parseJwt(token) {
      try {
        const base64Url = token.split('.')[1];
        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
        const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
        }).join(''));
        return JSON.parse(jsonPayload);
      } catch {
        return {};
      }
    }

    window.addEventListener("load", () => {
      initializeGoogleSignIn();
      // Initialize other app parts here as needed
    });
  </script>
</body>
</html>
